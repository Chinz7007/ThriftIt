<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} – ThriftIt</title>

    <!-- Link to external CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style_product_detail.css') }}">
</head>
<body>
    {% include 'profile_header.html' %}

    <div class="container">
        <div class="main-product">
            <!-- Favourite Star -->
            <div class="fav-container">
                <span class="fav-star" 
                      data-product-id="{{ product.id }}" 
                      onclick="toggleWishlist(this, {{ product.id }})">
                    ☆
                </span>
            </div>

            <!-- UPDATED: Handle both Cloudinary URLs and local files -->
            {% if product.image.startswith('http') %}
                <img src="{{ product.image }}" alt="{{ product.name }}">
            {% else %}
                <img src="{{ url_for('uploads', filename=product.image) }}" alt="{{ product.name }}">
            {% endif %}
            
            <h1>{{ product.name }}</h1>
            <div class="price"><strong>Price:</strong> RM{{ "%.2f"|format(product.price) }}</div>

            <div class="buttons">
                {% if product.seller_id == current_user.id %}
                    <span class="button disabled">Your Product</span>
                {% else %}
                    <a href="{{ url_for('chat_with_seller', product_id=product.id) }}" class="button">Chat with Seller</a>
                {% endif %}
            </div>

            <div class="details">
                <h2>Details</h2>
                <div class="detail-item"><strong>Condition:</strong> {{ product.condition }}</div>
                <div class="detail-item"><strong>Description:</strong> {{ product.description }}</div>
                <div class="detail-item"><strong>Seller:</strong> {{ product.seller.student_id }}</div>
            </div>

            <a class="back-link" href="{{ url_for('products') }}">← Back to Products</a>
        </div>

        <div class="recent-box">
            <h3>Recently Added</h3>
            {% for item in recent_products %}
            {% if item.id != product.id %}
            <div class="recent-item">
                <!-- UPDATED: Handle both Cloudinary URLs and local files -->
                {% if item.image.startswith('http') %}
                    <img src="{{ item.image }}" alt="{{ item.name }}">
                {% else %}
                    <img src="{{ url_for('uploads', filename=item.image) }}" alt="{{ item.name }}">
                {% endif %}
                <a href="{{ url_for('product_detail', product_id=item.id) }}">{{ item.name }}</a>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Link to external JavaScript -->
    <script src="{{ url_for('static', filename='script_product_detail.js') }}"></script>
</body>
</html>